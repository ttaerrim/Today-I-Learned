# 동기와 비동기

자바스크립트 엔진은 한 번에 하나의 태스크만 실행할 수 있는 **Single Thread**  
처리에 시간이 걸리는 태스크를 실행하는 경우 **Blocking (작업 중단)** 발생

### 자바스크립트 엔진

자바스크립트 엔진의 주요 구성 요소

- Memory Heap  
  : 변수와 객체의 메모리 할당을 담당한다.  
  : 콜 스택의 요소인 실행 컨텍스트는 힙에 저장된 객체를 참조한다.

- Call Stack  
  : 함수가 호출되면 쌓이는 곳.  
  : 함수의 실행 컨텍스크가 순차적으로 콜 스택에 푸시되고 순차적으로 실행된다. 단 하나의 콜 스택을 사용하기 때문에 실행 중인 실행 컨텍스트가 종료되어 콜 스택에서 제거되기 전까지는 다른 어떤 태스크도 실행되지 않음.  
  : LIFO(Last In First Out) 구조이므로 가장 마지막에 쌓인 것이 가장 먼저 나감.

비동기 구현 방법

- Task Queue  
  : 비동기 함수의 콜백 함수나 이벤트 핸들러가 일시적으로 보관되는 영역.

- Event Loop  
  : 콜 스택에 실행 중인 실행 컨텍스트가 있는지, 태스크 큐에 대기 중인 함수가 있는지 계속해서 확인함  
  : 콜 스택이 비어 있고 태스크 큐에 대기 중인 함수가 있으면 FIFO 방식으로 태스크 큐의 함수를 콜 스택으로 이동시켜 실행시킴  
  -> **태스크 큐에 일시 보관된 함수들은 비동기 처리 방식으로 동작한다**

![](https://miro.medium.com/max/1400/0*bomRmK3dJoIH1h6m.png)

## 비동기

현재 실행 중인 태스크가 종료되지 않았어도 다음 태스크를 곧바로 실행하는 방식.  
블로킹이 발생하지 않지만, **태스크의 실행 순서가 보장되지 않음**.

#### 비동기가 필요한 이유?

웹 페이지를 사용자에게 보여 줄 때 하나씩 차례차례 수행하다 보면 분명 느리게 실행되는 구간도 있을 거임. 근데 그러면 사용자 경험은 안 좋아지겠지. 사용자에게 보여 줄 수 있는 건 미리 보여 주면서 서버에서 데이터를 비동기로 불러온다면 사용자 경험이 더 좋아질 것이다.

비동기 처리를 수행하는 비동기 함수는 **콜백 패턴**을 사용한다.

비동기 처리의 예시는 다음과 같다.

- setTimeout
- setInterval
- HTTP 요청
- 이벤트 핸들러

비동기 처리에서는 소스코드와 평가와 실행을 제외한 모든 처리는 자바스크립트 엔진을 구동하는 환경인 브라우저 또는 Node.js가 담당한다.

> ex) setTimeout의 콜백 함수의 평가와 실행은 자바스크립트 엔진이 담당, 호출 스케줄링을 위한 타이머 설정과 콜백 함수의 등록은 브라우저 또는 Node.js가 담당
