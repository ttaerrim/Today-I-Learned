# 브라우저 저장소

## 🌐 웹 스토리지 (Web Storage)

Web Storage란 HTML5부터 제공하는 기능으로, 해당 도메인과 관련된 특정 데이터를 서버가 아닌 클라이언트 웹 브라우저에 저장할 수 있도록 하는 기능이다.

쿠키(cookie)와 비슷한 기능이고, 키-값 쌍으로 데이터를 저장하고 키를 기반으로 데이터를 조회할 수 있다. Local Storage와 Session Storage를 따로 두어 데이터의 지속성을 구분할 수 있어 응용 환경에 맞는 선택이 가능하다.

Web Storage는 사이트의 도메인 단위로 접근이 제한된다. A 도메인에서 저장한 데이터는 B 도메인에서 조회할 수 없다.

웹 스토리지는 보안성이 없으므로 인증, 결제와 관련된 중요 정보를 저장해서는 안 된다.

### ✔️ 로컬 스토리지 (Local Storage)

로컬 스토리지는 브라우저에 반영구적으로 데이터를 저장하며 브라우저를 종료해도 데이터가 유지된다. 도메인이 다른 경우에는 로컬 스토리지에 접근할 수 없다. `www.google.com`에서 로컬 스토리지에 저장한 데이터를 `www.naver.com`에서 접근할 수 없다는 뜻이다.

코드 상에서는 다음과 같이 접근할 수 있다.

```javascript
localStorage.setItem("item1", 10);
localStorage.setItem("item2", "new item");
localStorage.setItem("item3", 0.543534);

console.log(localStorage.getItem("item1"));
console.log(localStorage.getItem("item2"));
console.log(localStorage.getItem("item3"));
```

크롬 브라우저의 개발자 도구 - 애플리케이션 - 로컬 스토리지에서 확인할 수 있다.
<img width="1435" alt="스크린샷 2022-03-26 21 59 21" src="https://user-images.githubusercontent.com/43867711/160240532-bd672448-ccc4-4bb2-aa39-5f97015a8266.png"/>

콘솔에는 다음과 같이 출력된다.

<img width="154" alt="스크린샷 2022-03-26 21 59 28" src="https://user-images.githubusercontent.com/43867711/160240538-f6d459ad-9041-4655-b4e7-941b873b3616.png"/>

로컬 스토리지에는 문자열만 사용할 수 있고, 숫자나 객체 등을 저장하면 자동으로 문자열로 캐스팅된다.

### ✔️ 세션 스토리지 (Session Storage)

세션 스토리지는 각 세션마다 데이터가 개별적으로 저장된다. 브라우저에서 여러 개의 탭을 실행하면 탭마다 개별적으로 데이터가 저장되는 것이다. 세션 스토리지는 세션을 종료하면 데이터가 자동으로 삭제되며, 같은 도메인이더라도 세션이 다르면 데이터에 접근할 수 없다. 세션 스토리지에서 데이터를 읽고 쓰는 방법은 로컬 스토리지에서 데이터에 접근하는 방법과 동일하다.

```javascript
sessionStorage.setItem("item1", 10);
sessionStorage.setItem("item2", "new item");
sessionStorage.setItem("item3", 0.543534);

console.log(sessionStorage.getItem("item2"));
console.log(sessionStorage.getItem("item2"));
console.log(sessionStorage.getItem("item3"));
```

### ❗️ 로컬 스토리지와 세션 스토리지의 차이

로컬 스토리지와 세션 스토리지의 차이는 **영구성**에 있다. 로컬 스토리지는 데이터를 직접 지우기 전까지 브라우저에 데이터가 남고, 세션 스토리지는 윈도우나 브라우저 탭을 닫을 경우 삭제된다.

따라서 지속적으로 필요한 데이터는 로컬 스토리지에 저장하고, 일시적으로 필요한 데이터는 세션 스토리지에 저장하는 것이 바람직하다.

## 🍪 쿠키 (Cookie)

쿠키는 브라우저에 저장되는 작은 크기의 문자열로, HTTP 프로토콜의 일부이다.

쿠키는 주로 웹 서버에 의해 만들어진다. 서버가 HTTP 응답 헤더의 `set-cookie`에 내용을 넣어 전달하면, 브라우저는 이 내용을 자체적으로 브라우저에 저장한다. 브라우저는 사용자가 쿠키를 생성하도록 한 동일 서버에 접속할 때마다 쿠키의 내용을 Cookie 요청 헤더에 넣어서 함께 전달한다.

쿠키는 클라이언트 식별과 같은 인증에 가장 많이 쓰인다.

1. 사용자가 로그인하면 서버는 HTTP 응답 헤더의 `set-cookie`에 담긴 "세션 식별자(session identifier)" 정보를 사용하여 쿠키를 설정한다.
2. 사용자가 동일 도메인에 접속하려고 하면 브라우저는 HTTP Cookie 헤더에 인증 정보가 담긴 고유값(세션 식별자)을 함께 넣어 서버에 요청을 보낸다.
3. 서버는 브라우저가 보낸 요청 헤더의 세션 식별자를 읽어 사용자를 식별한다.

`document.cookie` 프로퍼티를 이용하면 브라우저에서도 쿠키에 접근할 수 있다.

#### 쿠키의 단점

- 4KB의 데이터 저장 제한으로 사이즈가 작음
- HTTP Request에 암호화되지 않은 상태로 사용하기 때문에 보안에 취약
- 모든 HTTP Request에 포함되어 있기 때문에 웹 서비스 성능에 영향 끼칠 수 있음 -> 데이터 전달 낭비

### ❗️ 웹 스토리지와 쿠키의 차이

|                  | 쿠키                                    | 웹 스토리지        |
| :--------------- | :-------------------------------------- | :----------------- |
| 서버 전송        | 모든 HTTP 요청에 포함되어 서버로 전송됨 | 서버 전송하지 않음 |
| 용량 제한        | 최대 4KB                                | 최대 5MB           |
| 영구 데이터 저장 | 만료일을 설정해야 함                    | 영구 저장 가능     |

## ▪️ 세션 (Session)

일정 시간 동안 같은 브라우저로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 일정하게 유지시키는 기술이다. 여기서 일정 시간이란, 방문자가 웹 브라우저를 통해 웹 서버에 접속한 시점으로부터 웹 브라우저를 종료하여 연결을 끝내는 시점을 말한다.

즉, **방문자가 웹 서버에 접속해 있는 상태를 하나의 단위로 보고 그것을 세션**이라고 한다.

### 특징

- 웹 서버에 웹 컨테이너의 상태를 유지하기 위한 정보를 저장
- 브라우저를 닫거나 서버에서 세션을 삭제했을 때만 삭제가 되므로 쿠키보다 보안이 좋음
- 용량 제한이 없음
- 각 클라이언트의 고유 세션 ID를 부여해 클라이언트를 구분함

### 동작 순서

1. 클라이언트가 페이지를 요청
2. 서버가 접근한 클라이언트의 request-header 필드의 cookie를 확인하여 클라이언트가 해당 session-id를 전송했는지 확인
3. session-id가 존재하지 않는다면 session-id를 생성해 클라이언트에게 반환
4. 서버에서 클라이언트에게 준 session-id를 쿠키를 사용해 서버에 저장
5. 클라이언트는 재접속할 때 쿠키를 사용해 session-id 값을 서버에 전달

### ❗️ 쿠키와 세션의 차이

|                                | 쿠키                    | 세션           |
| :----------------------------- | :---------------------- | :------------- |
| 정보 저장 위치                 | 서버 자원 사용하지 않음 | 서버 자원 사용 |
| 보안                           | 비교적 취약             | 비교적 우수    |
| 브라우저 종료 시 라이프 사이클 | 유지될 수 있음          | 삭제됨         |
| 속도                           | 비교적 빠름             | 비교적 느림    |

세션도 결국 쿠키를 사용하기 때문에 동작 원리는 비슷하다.

세션이 쿠키에 비해 보안 면에서 더 우수하나, 세션은 서버에 저장되고 서버의 자원을 사용하기 때문에 한계가 있고, 속도가 느려질 수 있다. 따라서 자원 관리 차원에서 쿠키와 세션을 적절하게 사용하여 서버 자원 낭비를 방지하고 웹 사이트의 속도를 높일 수 있다.

## ✔️ 캐시 (Cache)

캐시는 자주 사용하는 이미지, 비디오, css, js 파일 같은 웹 페이지 요소를 미리 복사해 리소스 파일을 저장하는 임시 저장소이다. 웹 페이지를 빠르게 렌더링 할 수 있도록 도와준다.

- 저장 공간이 작고 비용이 비싸나 빠른 성능을 제공한다.
- 같은 웹 페이지에 접속할 때 사용자의 PC에서 로드하므로 서버를 거치지 않는다.
- 이전에 사용된 데이터가 다시 사용될 가능성이 많으면 캐시 서버에 있는 데이터를 사용한다.
- 캐시 힛 (Cache Hit): 원하는 데이터가 캐시에 존재할 경우 해당 데이터를 반환한다.
- 캐시 미스 (Cache Miss): 원하는 데이터가 캐시에 존재하지 않을 경우 서버에 요청한다.

## ✔️ 사용 예시

| 브라우저 저장소 | 예시                          |
| :-------------- | :---------------------------- |
| 로컬 스토리지   | 자동 로그인                   |
| 세션 스토리지   | 입력 폼 정보, 비회원 장바구니 |
| 쿠키            | 다시 보지 않음 팝업 창        |
| 세션            | 화면 이동해도 로그인 유지     |

### 🚩 참고

[ES6로 기초부터 다시 배우는 자바스크립트 파워북](http://www.yes24.com/Product/Goods/93235652)  
[웹 스토리지 (Web Storage)의 특성과 사용법](https://untitledtblog.tistory.com/47)  
[브라우저 저장소(웹저장소), Cookie, Session란?](https://akdl911215.tistory.com/317?category=975797)  
[쿠키와 document.cookie](https://ko.javascript.info/cookie)
[쿠키와 세션 특징 및 차이](https://hahahoho5915.tistory.com/32)
